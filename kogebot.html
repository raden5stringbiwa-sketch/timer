<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã‚ã¼ã£ã¨ã“ã’ã¡ã‚ƒã‚“</title>
  <style>
    body {
      background-color: #111;
      color: #eee;
      font-family: sans-serif;
      text-align: center;
      padding: 30px;
    }
    h1 {
      color: #ff6600;
      font-size: 36px;
    }
    #countdown, #nextTime {
      font-size: 24px;
      margin: 10px 0;
    }
    #history {
      margin-top: 30px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      text-align: left;
    }
    #history div {
      background-color: #222;
      padding: 10px 14px;
      margin-bottom: 6px;
      border-left: 4px solid #ff6600;
      font-size: 18px;
      line-height: 1.4;
    }
    #startButton {
      background: linear-gradient(45deg, #ff6600, #ff3300);
      color: #fff;
      font-size: 24px;
      font-weight: bold;
      padding: 16px 32px;
      border: none;
      border-radius: 12px;
      box-shadow: 0 0 15px #ff6600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.3s;
    }
    #startButton:hover {
      transform: scale(1.05);
      box-shadow: 0 0 25px #ff3300;
    }
  </style>
</head>
<body>
  <h1>ğŸ¤– ãƒ­ãƒœãƒƒãƒˆã“ã’ã¡ã‚ƒã‚“ ğŸ¤–</h1>
  <button id="startButton" onclick="startTimer()">ğŸ”¥ ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹ ğŸ”¥</button>
  <p id="countdown">æ®‹ã‚Šæ™‚é–“: -</p>
  <p id="nextTime">60åˆ†å¾Œã®æ™‚åˆ»: -</p>
  <div id="history"></div>

  <!-- éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«å®šç¾© -->
  <audio id="buff90"        src="buff_90sec.mp3"    preload="auto"></audio>
  <audio id="buff30"        src="buff_30sec.mp3"    preload="auto"></audio>
  <audio id="buffSpawn"     src="buff_spawn.mp3"    preload="auto"></audio>

  <audio id="tower1min"     src="tower_1min.mp3"    preload="auto"></audio>
  <audio id="towerStart"    src="tower_start.mp3"   preload="auto"></audio>

  <audio id="point1min"     src="point_1min.mp3"    preload="auto"></audio>
  <audio id="pointSpawn"    src="point_spawn.mp3"   preload="auto"></audio>

  <audio id="castle1min"    src="castle_1min.mp3"   preload="auto"></audio>
  <audio id="castleStart"   src="castle_start.mp3"  preload="auto"></audio>

  <audio id="center1min"    src="center_1min.mp3"   preload="auto"></audio>
  <audio id="centerStart"   src="center_start.mp3"  preload="auto"></audio>

  <audio id="endSound"      src="end.mp3"           preload="auto"></audio>

  <audio id="castle14_1min" src="castle14_1min.mp3" preload="auto"></audio>
  <audio id="castle14_start" src="castle14_start.mp3" preload="auto"></audio>

  <audio id="custom242"     src="242.mp3"           preload="auto"></audio>

  <script>
    let timer;
    let startTime;
    const totalSeconds = 3600;
    const playedEvents = new Set();

    // æ™‚é–“èª¿æ•´æ¸ˆã¿ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒƒãƒ—
    const eventMap = {
      140:  { id: "buff90",        label: "ãƒãƒ•1åˆ†åŠå‰" },
      210:  { id: "buff30",        label: "ãƒãƒ•30ç§’å‰" },
      238:  { id: "buffSpawn",     label: "ãƒãƒ•æ¹§ãã‚ˆï¼" },

      650:  { id: "buff90",        label: "ãƒãƒ•1åˆ†åŠå‰" },
      720:  { id: "buff30",        label: "ãƒãƒ•30ç§’å‰" },
      748:  { id: "buffSpawn",     label: "ãƒãƒ•æ¹§ãã‚ˆï¼" },

      1250: { id: "buff90",        label: "ãƒãƒ•1åˆ†åŠå‰" },
      1320: { id: "buff30",        label: "ãƒãƒ•30ç§’å‰" },
      1348: { id: "buffSpawn",     label: "ãƒãƒ•æ¹§ãã‚ˆï¼" },

      1850: { id: "buff90",        label: "ãƒãƒ•1åˆ†åŠå‰" },
      1920: { id: "buff30",        label: "ãƒãƒ•30ç§’å‰" },
      1948: { id: "buffSpawn",     label: "ãƒãƒ•æ¹§ãã‚ˆï¼" },

      2450: { id: "buff90",        label: "ãƒãƒ•1åˆ†åŠå‰" },
      2520: { id: "buff30",        label: "ãƒãƒ•30ç§’å‰" },
      2548: { id: "buffSpawn",     label: "ãƒãƒ•æ¹§ãã‚ˆï¼" },

      3050: { id: "buff90",        label: "ãƒãƒ•1åˆ†åŠå‰" },
      3120: { id: "buff30",        label: "ãƒãƒ•30ç§’å‰" },
      3148: { id: "buffSpawn",     label: "ãƒãƒ•æ¹§ãã‚ˆï¼" },

      360:  { id: "tower1min",     label: "æœ›æ¥¼1åˆ†å‰" },
      418:  { id: "towerStart",    label: "æœ›æ¥¼é–‹å§‹ï¼" },

      540:  { id: "point1min",     label: "1000ãƒã‚¤ãƒ³ãƒˆ1åˆ†å‰" },
      600:  { id: "pointSpawn",    label: "1000ãƒã‚¤ãƒ³ãƒˆæ¹§ãã‚ˆï¼" },

      1140: { id: "point1min",     label: "1000ãƒã‚¤ãƒ³ãƒˆ1åˆ†å‰" },
      1200: { id: "pointSpawn",    label: "1000ãƒã‚¤ãƒ³ãƒˆæ¹§ãã‚ˆï¼" },

      1740: { id: "point1min",     label: "1000ãƒã‚¤ãƒ³ãƒˆ1åˆ†å‰" },
      1800: { id: "pointSpawn",    label: "1000ãƒã‚¤ãƒ³ãƒˆæ¹§ãã‚ˆï¼" },

      2340: { id: "point1min",     label: "1000ãƒã‚¤ãƒ³ãƒˆ1åˆ†å‰" },
      2400: { id: "pointSpawn",    label: "1000ãƒã‚¤ãƒ³ãƒˆæ¹§ãã‚ˆï¼" },

      2940: { id: "point1min",     label: "1000ãƒã‚¤ãƒ³ãƒˆ1åˆ†å‰" },
      3000: { id: "pointSpawn",    label: "1000ãƒã‚¤ãƒ³ãƒˆæ¹§ãã‚ˆï¼" },

      840:  { id: "castle1min",    label: "2åŸãƒ»3åŸ1åˆ†å‰" },
      898:  { id: "castleStart",   label: "2åŸãƒ»3åŸé–‹å§‹ï¼" },

      1560: { id: "center1min",    label: "ä¸­å¤®1åˆ†å‰" },
      1618: { id: "centerStart",   label: "ä¸­å¤®é–‹å§‹" },

      2040: { id: "castle14_1min",  label: "1ãƒ»4åŸ1åˆ†å‰" },
      2098: { id: "castle14_start", label: "1ãƒ»4åŸé–‹å§‹ï¼" },

      3358: { id: "custom242",     label: "æ®‹ã‚Š242ç§’å‰" }
    };
async function startTimer() {
  clearInterval(timer);
  playedEvents.clear();
  startTime = new Date();

  const future = new Date(startTime.getTime() + totalSeconds * 1000);
  document.getElementById("nextTime").textContent =
    "60åˆ†å¾Œã®æ™‚åˆ»: " + future.toLocaleTimeString();
  document.getElementById("history").innerHTML = "";

  // âœ… AudioContextï¼ˆéŸ³é‡ãƒ–ãƒ¼ã‚¹ãƒˆç”¨ï¼‰ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œå†…ã§ä½œæˆ
  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  await audioCtx.resume();  

      // âœ… æ­£ã—ã„ boostAudio é–¢æ•°ï¼ˆ1.5å€ãƒ–ãƒ¼ã‚¹ãƒˆï¼‰
      function boostAudio(audioElement, gainValue = 1.5) {
        if (!audioElement) return;
        const source = audioCtx.createMediaElementSource(audioElement);
        const gainNode = audioCtx.createGain();
        gainNode.gain.value = gainValue;
        source.connect(gainNode).connect(audioCtx.destination);
      }

      // âœ… å…¨éŸ³å£°ã‚’1.5å€ã«ãƒ–ãƒ¼ã‚¹ãƒˆ
      Object.values(eventMap).forEach(e => {
        const a = document.getElementById(e.id);
        boostAudio(a, 1.5);
      });
      boostAudio(document.getElementById("endSound"), 1.5);

      // ã¤ã„ã§ã«äº‹å‰ãƒ­ãƒ¼ãƒ‰
      Object.values(eventMap).forEach(e => {
        try {
          document.getElementById(e.id).load();
        } catch (err) {}
      });
      document.getElementById("endSound").load();

      timer = setInterval(() => {
        const now = new Date();
        const elapsed = Math.floor((now - startTime) / 1000);
        const remaining = totalSeconds - elapsed;
        const minutes = Math.floor(remaining / 60);
        const seconds = remaining % 60;
        document.getElementById("countdown").textContent =
          `æ®‹ã‚Šæ™‚é–“: ${minutes}åˆ†${seconds}ç§’`;

        if (eventMap[elapsed] && !playedEvents.has(elapsed)) {
          const { id, label } = eventMap[elapsed];
          const audio = document.getElementById(id);
          if (audio) {
            audio.currentTime = 0;
            audio.play();
            const mm = String(Math.floor(elapsed / 60)).padStart(2, '0');
            const ss = String(elapsed % 60).padStart(2, '0');
            const timestamp = now.toLocaleTimeString();
            const entry = document.createElement("div");
            entry.textContent = `${mm}åˆ†${ss}ç§’çµŒéãƒ»${label}ãƒ»${timestamp}`;
            const history = document.getElementById("history");
            history.insertBefore(entry, history.firstChild);
            playedEvents.add(elapsed);
          }
        }

        if (remaining <= 0) {
          clearInterval(timer);
          const endAudio = document.getElementById("endSound");
          endAudio.currentTime = 0;
          endAudio.play();
          const entry = document.createElement("div");
          entry.textContent =
            `60åˆ†00ç§’çµŒéãƒ»ã‚¿ã‚¤ãƒãƒ¼çµ‚äº†ãƒ»${now.toLocaleTimeString()}`;
          const history = document.getElementById("history");
          history.insertBefore(entry, history.firstChild);
        }
      }, 1000);
    }
  </script>
</body>
</html>
